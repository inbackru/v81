{% extends "base.html" %}

{% block title %}Установка нового пароля | inback{% endblock %}

{% block content %}
<style>
    .gradient-bg {
        background: linear-gradient(135deg, #0088cc 0%, #32a4fb 100%);
    }
    
    .btn-ton {
        background: linear-gradient(135deg, #0088cc 0%, #32a4fb 100%);
        transition: all 0.3s ease;
    }
    
    .btn-ton:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
    }
    
    .input-ton {
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
    }
    
    .input-ton:focus {
        border-color: #0088cc;
        box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.1);
    }
    
    .password-strength {
        height: 4px;
        border-radius: 2px;
        transition: all 0.3s ease;
    }
    
    .strength-weak { background: #ef4444; width: 33%; }
    .strength-medium { background: #f59e0b; width: 66%; }
    .strength-strong { background: #10b981; width: 100%; }
</style>

<div class="relative overflow-hidden min-h-screen bg-gray-50">
    <div class="absolute top-0 left-0 w-full h-1 gradient-bg"></div>
    
    <div class="container mx-auto px-4 py-12">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden max-w-md w-full">
                <div class="p-8">
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-[#0088CC] to-[#006699] rounded-full mb-4">
                            <i class="fas fa-lock text-white text-2xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Установка нового пароля</h3>
                        <p class="text-gray-500">Придумайте надежный пароль для вашего аккаунта</p>
                    </div>
                    
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="mb-4 p-4 rounded-lg {% if category == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-green-50 text-green-700 border border-green-200{% endif %}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    
                    <!-- Reset Password Form -->
                    <form method="POST" action="{{ url_for('reset_password') }}" id="reset-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
                        <!-- Password Input -->
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="password">
                                Новый пароль
                            </label>
                            <div class="relative">
                                <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                                <input 
                                    class="input-ton w-full pl-10 pr-12 py-3 rounded-lg border focus:outline-none" 
                                    id="password" 
                                    name="password" 
                                    type="password" 
                                    placeholder="Минимум 6 символов"
                                    required
                                    minlength="6"
                                />
                                <button 
                                    type="button" 
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600" 
                                    onclick="togglePassword('password')"
                                >
                                    <i class="fas fa-eye" id="password-eye"></i>
                                </button>
                            </div>
                            <div class="mt-2">
                                <div class="password-strength" id="strength-bar"></div>
                                <p class="text-xs text-gray-500 mt-1" id="strength-text">Введите пароль</p>
                            </div>
                        </div>
                        
                        <!-- Confirm Password Input -->
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-medium mb-2" for="confirm_password">
                                Подтвердите пароль
                            </label>
                            <div class="relative">
                                <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                                <input 
                                    class="input-ton w-full pl-10 pr-12 py-3 rounded-lg border focus:outline-none" 
                                    id="confirm_password" 
                                    name="confirm_password" 
                                    type="password" 
                                    placeholder="Повторите пароль"
                                    required
                                />
                                <button 
                                    type="button" 
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600" 
                                    onclick="togglePassword('confirm_password')"
                                >
                                    <i class="fas fa-eye" id="confirm_password-eye"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1" id="match-text"></p>
                        </div>
                        
                        <!-- Password Requirements -->
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <p class="text-sm font-medium text-gray-700 mb-2">Требования к паролю:</p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li id="req-length" class="flex items-center">
                                    <i class="fas fa-circle text-gray-300 mr-2" style="font-size: 6px;"></i>
                                    Минимум 6 символов
                                </li>
                                <li id="req-match" class="flex items-center">
                                    <i class="fas fa-circle text-gray-300 mr-2" style="font-size: 6px;"></i>
                                    Пароли должны совпадать
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Submit Button -->
                        <button 
                            type="submit" 
                            class="btn-ton w-full text-white font-bold py-3 px-4 rounded-lg focus:outline-none"
                            id="submit-btn"
                        >
                            Сохранить новый пароль
                        </button>
                    </form>
                    
                    <!-- Back to Login -->
                    <div class="mt-6 text-center">
                        <a href="{{ url_for('login') }}" class="text-[#0088CC] hover:underline">
                            <i class="fas fa-arrow-left mr-1"></i> Вернуться к входу
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const eye = document.getElementById(fieldId + '-eye');
    
    if (field.type === 'password') {
        field.type = 'text';
        eye.classList.remove('fa-eye');
        eye.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        eye.classList.remove('fa-eye-slash');
        eye.classList.add('fa-eye');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm_password');
    const strengthBar = document.getElementById('strength-bar');
    const strengthText = document.getElementById('strength-text');
    const matchText = document.getElementById('match-text');
    const reqLength = document.getElementById('req-length');
    const reqMatch = document.getElementById('req-match');
    const submitBtn = document.getElementById('submit-btn');
    
    // Password strength checker
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        const length = password.length;
        
        // Update length requirement
        if (length >= 6) {
            reqLength.querySelector('i').classList.remove('text-gray-300', 'fa-circle');
            reqLength.querySelector('i').classList.add('text-green-500', 'fa-check-circle');
        } else {
            reqLength.querySelector('i').classList.remove('text-green-500', 'fa-check-circle');
            reqLength.querySelector('i').classList.add('text-gray-300', 'fa-circle');
        }
        
        // Password strength
        if (length === 0) {
            strengthBar.className = 'password-strength';
            strengthText.textContent = 'Введите пароль';
        } else if (length < 6) {
            strengthBar.className = 'password-strength strength-weak';
            strengthText.textContent = 'Слишком короткий пароль';
            strengthText.classList.add('text-red-500');
        } else if (length < 10) {
            strengthBar.className = 'password-strength strength-medium';
            strengthText.textContent = 'Средняя надежность';
            strengthText.classList.remove('text-red-500');
            strengthText.classList.add('text-yellow-600');
        } else {
            strengthBar.className = 'password-strength strength-strong';
            strengthText.textContent = 'Надежный пароль';
            strengthText.classList.remove('text-red-500', 'text-yellow-600');
            strengthText.classList.add('text-green-500');
        }
        
        checkPasswordMatch();
    });
    
    // Confirm password checker
    confirmInput.addEventListener('input', checkPasswordMatch);
    
    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = confirmInput.value;
        
        if (confirm.length === 0) {
            matchText.textContent = '';
            reqMatch.querySelector('i').classList.remove('text-green-500', 'fa-check-circle');
            reqMatch.querySelector('i').classList.add('text-gray-300', 'fa-circle');
        } else if (password === confirm) {
            matchText.textContent = '✓ Пароли совпадают';
            matchText.classList.remove('text-red-500');
            matchText.classList.add('text-green-500');
            reqMatch.querySelector('i').classList.remove('text-gray-300', 'fa-circle');
            reqMatch.querySelector('i').classList.add('text-green-500', 'fa-check-circle');
        } else {
            matchText.textContent = '✗ Пароли не совпадают';
            matchText.classList.remove('text-green-500');
            matchText.classList.add('text-red-500');
            reqMatch.querySelector('i').classList.remove('text-green-500', 'fa-check-circle');
            reqMatch.querySelector('i').classList.add('text-gray-300', 'fa-circle');
        }
    }
    
    // Form validation
    document.getElementById('reset-form').addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirm = confirmInput.value;
        
        if (password.length < 6) {
            e.preventDefault();
            alert('Пароль должен быть не менее 6 символов');
            return false;
        }
        
        if (password !== confirm) {
            e.preventDefault();
            alert('Пароли не совпадают');
            return false;
        }
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Сохранение...';
    });
});
</script>
{% endblock %}
