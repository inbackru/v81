{% extends "base.html" %}

{% block title %}Блог о недвижимости | InBack{% endblock %}
{% block description %}Свежие статьи, экспертные мнения и полезные руководства по покупке жилья и получению кэшбека{% endblock %}
{% block keywords %}блог о недвижимости, кэшбек за квартиру, покупка жилья, новостройки Краснодар{% endblock %}

{% block extra_head %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Главная",
    "item": "https://inback.ru/"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "Блог",
    "item": "https://inback.ru/blog"
  }]
}
</script>
{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<div class="container mx-auto px-4 py-3 text-sm">
    <nav aria-label="Breadcrumb" class="flex">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a class="text-[#0088CC] hover:underline inline-flex items-center" href="{{ url_for('index') }}">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                    </svg>
                    Главная
                </a>
            </li>
            <li aria-current="page">
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path clip-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" fill-rule="evenodd"></path>
                    </svg>
                    <span class="text-gray-500 ml-1 md:ml-2">Блог</span>
                </div>
            </li>
        </ol>
    </nav>
</div>

<!-- Hero Section -->
<section class="bg-[#0088CC] text-white">
    <div class="container mx-auto px-4 py-16">
        <div class="max-w-3xl mx-auto text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">
                Блог о недвижимости в Краснодаре
            </h1>
            <p class="text-lg opacity-90 mb-8">
                Экспертные статьи, аналитика рынка и практические советы по покупке квартир
            </p>
            
            <!-- Search -->
            <div class="max-w-md mx-auto mb-6">
                <div class="relative">
                    <input type="text" 
                           id="blog-search" 
                           placeholder="Поиск по статьям..."
                           class="w-full px-4 py-3 pr-12 rounded-lg border-0 focus:ring-2 focus:ring-blue-300 focus:outline-none">
                    <button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="openApplicationModal()" class="bg-white text-[#0088CC] px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                    Получить консультацию
                </button>
                <a href="{{ url_for('properties') }}" class="border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-[#0088CC] transition-colors">
                    Смотреть объекты
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container mx-auto px-4 py-12">
    <div class="grid lg:grid-cols-4 gap-8">
        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-6">
            <!-- CTA Block -->
            <div class="bg-[#0088CC] text-white rounded-lg p-6 sticky top-4">
                <h3 class="font-bold text-lg mb-2">Получите кэшбек</h3>
                <p class="text-sm mb-4 opacity-90">
                    До 500 000 ₽ при покупке квартиры через InBack
                </p>
                <button onclick="openApplicationModal()" class="w-full bg-white text-[#0088CC] py-3 px-4 rounded font-semibold hover:bg-gray-100 transition-colors">
                    Узнать размер кэшбека
                </button>
                <div class="mt-2 text-xs opacity-75 text-center">
                    Консультация бесплатно
                </div>
            </div>

            <!-- Categories -->
            <div class="bg-white border rounded-lg p-6">
                <h2 class="text-lg font-semibold mb-4">
                    Категории статей
                </h2>
                
                <div class="space-y-2">
                    <a href="#" class="category-filter flex items-center justify-between p-3 rounded bg-blue-50 border hover:bg-gray-100 transition-colors" data-category="all">
                        <span class="font-medium text-blue-900">Все статьи</span>
                        <span class="bg-[#0088CC] text-white px-2 py-1 rounded text-sm">{{ articles|length }}</span>
                    </a>
                    
                    {% set categories = [
                        ('Кэшбек', 'Кэшбек', 'fas fa-percent', 'from-green-50 to-emerald-100', 'border-green-200', 'bg-green-600', 'text-green-900'),
                        ('Районы Краснодара', 'Районы Краснодара', 'fas fa-map-marker-alt', 'from-orange-50 to-orange-100', 'border-orange-200', 'bg-orange-600', 'text-orange-900'),
                        ('Ипотека', 'Ипотека', 'fas fa-home', 'from-purple-50 to-purple-100', 'border-purple-200', 'bg-[#0088CC]', 'text-purple-900'),
                        ('Инвестиции', 'Инвестиции', 'fas fa-chart-line', 'from-yellow-50 to-yellow-100', 'border-yellow-200', 'bg-yellow-600', 'text-yellow-900'),
                        ('Новостройки', 'Новостройки', 'fas fa-building', 'from-teal-50 to-teal-100', 'border-teal-200', 'bg-teal-600', 'text-teal-900'),
                        ('Застройщики', 'Застройщики', 'fas fa-hard-hat', 'from-pink-50 to-pink-100', 'border-pink-200', 'bg-[#0088CC]', 'text-pink-900')
                    ] %}
                    
                    {% for category_id, category_name, icon, bg_gradient, border_color, icon_bg, text_color in categories %}
                    {% set category_count = articles|selectattr('category', 'equalto', category_id)|list|length %}
                    {% if category_count > 0 %}
                    <a href="#" class="category-filter flex items-center justify-between p-3 rounded border hover:bg-gray-50 transition-colors" data-category="{{ category_id }}">
                        <span class="font-medium text-gray-900">{{ category_name }}</span>
                        <span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-sm">{{ category_count }}</span>
                    </a>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Popular Articles -->
            <div class="bg-white border rounded-lg p-6">
                <h3 class="font-semibold text-lg mb-4">
                    Популярные статьи
                </h3>
                <div class="space-y-4">
                    {% for article in articles[:3] %}
                    <article class="group">
                        <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                            <div class="w-12 h-12 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                                <img src="{{ article.image }}" alt="{{ article.title }}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-sm mb-1 line-clamp-2 group-hover:text-[#0088CC] transition-colors">
                                    <a href="{{ url_for('blog_article', slug=article.slug) }}">{{ article.title }}</a>
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 space-x-3">
                                    <span class="flex items-center">
                                        <i class="fas fa-clock mr-1"></i>{{ article.reading_time }} мин
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-eye mr-1"></i>{{ article.views }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
                <div class="mt-4 text-center">
                    <a href="{{ url_for('blog') }}" class="text-[#0088CC] hover:text-[#006699] text-sm font-medium">
                        Смотреть все статьи →
                    </a>
                </div>
            </div>

            <!-- Calculator Widget -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                <h3 class="font-semibold text-lg mb-4">
                    Калькулятор кэшбека
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Стоимость квартиры</label>
                        <div class="relative">
                            <input type="number" id="property-price" placeholder="5000000" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 pr-8">
                            <span class="absolute right-3 top-3 text-gray-500 text-sm">₽</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Процент кэшбека</label>
                        <select id="cashback-percent" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="1">1% - стандарт</option>
                            <option value="2" selected>2% - популярный</option>
                            <option value="3">3% - максимум</option>
                        </select>
                    </div>
                    <div class="bg-white p-4 rounded border">
                        <div class="text-center">
                            <div class="text-sm text-gray-600">Ваш кэшбек:</div>
                            <div id="cashback-result" class="text-xl font-bold text-green-600">100 000 ₽</div>
                        </div>
                    </div>
                    <button onclick="openApplicationModal()" class="w-full bg-green-600 text-white py-2 px-4 rounded font-semibold hover:bg-green-700 transition-colors">
                        Получить консультацию
                    </button>
                </div>
            </div>

            <!-- Benefits Block -->
            <div class="bg-gray-50 border rounded-lg p-6">
                <h3 class="font-semibold text-lg mb-4">
                    Почему выбирают InBack
                </h3>
                <div class="space-y-3">
                    <div class="text-sm">
                        <div class="font-medium text-gray-900">Максимальный кэшбек</div>
                        <div class="text-gray-600">До 500 000 ₽ возврата</div>
                    </div>
                    <div class="text-sm">
                        <div class="font-medium text-gray-900">Юридическая защита</div>
                        <div class="text-gray-600">Полное сопровождение сделки</div>
                    </div>
                    <div class="text-sm">
                        <div class="font-medium text-gray-900">Быстрое оформление</div>
                        <div class="text-gray-600">От заявки до ключей</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Articles Grid -->
        <div class="lg:col-span-3">
            <div class="mb-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Последние статьи</h2>
                    <select id="sort-articles" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option value="date-desc">По дате (новые)</option>
                        <option value="date-asc">По дате (старые)</option>
                        <option value="views-desc">По популярности</option>
                    </select>
                </div>
            </div>
            
            <div id="articles-container" class="grid md:grid-cols-2 gap-6">
                {% for article in articles %}
                <article class="article-card bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow" data-category="{{ article.category }}">
                    <div class="aspect-video bg-gray-200 overflow-hidden">
                        <img src="{{ article.image }}" alt="{{ article.title }}" class="w-full h-full object-cover">
                    </div>
                    
                    <div class="p-6">
                        <div class="flex items-center mb-3">
                            <span class="px-2 py-1 text-xs font-medium text-[#006699] bg-gray-100 rounded-full">
                                {% if article.category == 'cashback' %}Кэшбек
                                {% elif article.category == 'districts' %}Районы
                                {% elif article.category == 'mortgage' %}Ипотека
                                {% elif article.category == 'investments' %}Инвестиции
                                {% elif article.category == 'new-buildings' %}Новостройки
                                {% elif article.category == 'developers' %}Застройщики
                                {% else %}Недвижимость
                                {% endif %}
                            </span>
                            <span class="text-sm text-gray-500 ml-auto">{{ article.date }}</span>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-2 line-clamp-2">
                            <a href="{{ url_for('blog_article', slug=article.slug) }}" class="text-gray-900 hover:text-[#0088CC] transition-colors">
                                {{ article.title }}
                            </a>
                        </h3>
                        
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">{{ article.excerpt }}</p>
                        
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center space-x-4">
                                <span><i class="fas fa-clock mr-1"></i>{{ article.reading_time }} мин</span>
                                <span><i class="fas fa-eye mr-1"></i>{{ article.views }}</span>
                            </div>
                            <a href="{{ url_for('blog_article', slug=article.slug) }}" class="text-[#0088CC] hover:text-[#006699] font-medium">
                                Читать →
                            </a>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
            
            <!-- Load More Button -->
            <div class="text-center mt-12">
                <button id="load-more" class="bg-[#0088CC] hover:bg-[#006699] text-white px-6 py-3 rounded font-medium transition-colors">
                    Загрузить ещё
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilters = document.querySelectorAll('.category-filter');
    const searchInput = document.getElementById('blog-search');
    const sortSelect = document.getElementById('sort-articles');
    const articlesContainer = document.getElementById('articles-container');
    const loadMoreBtn = document.getElementById('load-more');
    
    let currentCategory = 'all';
    let currentSearch = '';
    let visibleArticles = 6;
    const articlesPerLoad = 6;
    
    // Category filtering
    categoryFilters.forEach(filter => {
        filter.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active category
            categoryFilters.forEach(f => f.classList.remove('bg-blue-50', 'text-[#006699]', 'border-blue-200'));
            categoryFilters.forEach(f => f.classList.add('hover:bg-gray-50', 'border-gray-200'));
            
            this.classList.remove('hover:bg-gray-50', 'border-gray-200');
            this.classList.add('bg-blue-50', 'text-[#006699]', 'border-blue-200');
            
            currentCategory = this.dataset.category;
            filterArticles();
        });
    });
    
    // Search functionality
    searchInput.addEventListener('input', function() {
        currentSearch = this.value.toLowerCase();
        filterArticles();
    });
    
    // Sorting
    sortSelect.addEventListener('change', function() {
        sortArticles(this.value);
    });
    
    // Load more functionality
    loadMoreBtn.addEventListener('click', function() {
        visibleArticles += articlesPerLoad;
        filterArticles();
    });
    
    function filterArticles() {
        const articles = Array.from(document.querySelectorAll('.article-card'));
        let visibleCount = 0;
        
        articles.forEach(article => {
            const category = article.dataset.category;
            const title = article.querySelector('h3').textContent.toLowerCase();
            const excerpt = article.querySelector('p').textContent.toLowerCase();
            
            const matchesCategory = currentCategory === 'all' || category === currentCategory;
            const matchesSearch = currentSearch === '' || 
                                title.includes(currentSearch) || 
                                excerpt.includes(currentSearch);
            
            if (matchesCategory && matchesSearch && visibleCount < visibleArticles) {
                article.style.display = 'block';
                visibleCount++;
            } else {
                article.style.display = 'none';
            }
        });
        
        // Show/hide load more button
        const totalMatching = articles.filter(article => {
            const category = article.dataset.category;
            const title = article.querySelector('h3').textContent.toLowerCase();
            const excerpt = article.querySelector('p').textContent.toLowerCase();
            
            const matchesCategory = currentCategory === 'all' || category === currentCategory;
            const matchesSearch = currentSearch === '' || 
                                title.includes(currentSearch) || 
                                excerpt.includes(currentSearch);
            
            return matchesCategory && matchesSearch;
        }).length;
        
        loadMoreBtn.style.display = visibleCount < totalMatching ? 'block' : 'none';
    }
    
    function sortArticles(sortBy) {
        const articles = Array.from(document.querySelectorAll('.article-card'));
        
        articles.sort((a, b) => {
            switch(sortBy) {
                case 'date-desc':
                    return new Date(b.querySelector('.text-gray-500').textContent) - 
                           new Date(a.querySelector('.text-gray-500').textContent);
                case 'date-asc':
                    return new Date(a.querySelector('.text-gray-500').textContent) - 
                           new Date(b.querySelector('.text-gray-500').textContent);
                case 'views-desc':
                    const viewsA = parseInt(a.querySelector('.fa-eye').parentNode.textContent.match(/\d+/)[0]);
                    const viewsB = parseInt(b.querySelector('.fa-eye').parentNode.textContent.match(/\d+/)[0]);
                    return viewsB - viewsA;
                default:
                    return 0;
            }
        });
        
        articles.forEach(article => articlesContainer.appendChild(article));
        filterArticles();
    }
    
    // Initial filter
    filterArticles();
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.article-card {
    transition: transform 0.2s ease-in-out;
}

.article-card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}