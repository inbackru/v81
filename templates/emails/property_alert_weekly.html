{% extends "emails/base_email.html" %}

{% block title %}–ù–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ - InBack{% endblock %}

{% block content %}
<h1>üìÜ –ù–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞</h1>

<p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ user.full_name }}!</p>

<p>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –ø–æ—è–≤–∏–ª–æ—Å—å <strong>{{ properties_count }}</strong> 
{% if properties_count == 1 %}–Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç{% elif properties_count < 5 %}–Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–∞{% else %}–Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤{% endif %}, 
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—à–µ–º—É –ø–æ–∏—Å–∫—É <strong>"{{ search.name }}"</strong>.</p>

<!-- Summary Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin: 24px 0;">
    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; padding: 16px; text-align: center;">
        <div style="font-size: 32px; font-weight: 700; color: #0088CC;">{{ properties_count }}</div>
        <div style="font-size: 13px; color: #424245; margin-top: 4px;">–ù–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</div>
    </div>
    
    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 8px; padding: 16px; text-align: center;">
        <div style="font-size: 32px; font-weight: 700; color: #15803d;">
            {% set prices = [] %}
            {% for p in properties if p.price %}{% set _ = prices.append(p.price) %}{% endfor %}
            {% if prices %}{{ '{:,.0f}'.format(prices|min).replace(',', ' ') }}{% else %}‚Äî{% endif %}
        </div>
        <div style="font-size: 13px; color: #424245; margin-top: 4px;">–ú–∏–Ω. —Ü–µ–Ω–∞, ‚ÇΩ</div>
    </div>
    
    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px; padding: 16px; text-align: center;">
        <div style="font-size: 32px; font-weight: 700; color: #92400e;">
            {% set areas = [] %}
            {% for p in properties if p.area %}{% set _ = areas.append(p.area) %}{% endfor %}
            {% if areas %}{{ (areas|sum / areas|length)|round(1) }}{% else %}‚Äî{% endif %}
        </div>
        <div style="font-size: 13px; color: #424245; margin-top: 4px;">–°—Ä–µ–¥–Ω—è—è –ø–ª–æ—â–∞–¥—å, –º¬≤</div>
    </div>
</div>

<!-- Properties List -->
{% for property in properties %}
<div style="border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; margin: 16px 0; background: white;">
    <div style="display: flex; flex-direction: row; flex-wrap: wrap;">
        {% if property.main_image %}
        <div style="flex: 0 0 auto; width: 200px; min-height: 180px; background: #f3f4f6;">
            <img src="{{ property.main_image }}" alt="{{ property.title }}" 
                 style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        {% endif %}
        
        <div style="flex: 1; min-width: 250px; padding: 20px;">
            <h3 style="margin: 0 0 8px 0; font-size: 18px; font-weight: 600; color: #1d1d1f;">
                {{ property.title }}
            </h3>
            
            <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                {% if property.rooms is not none %}
                <span style="background: #f0f9ff; color: #0369a1; padding: 4px 10px; border-radius: 6px; font-size: 13px;">
                    {% if property.rooms == 0 %}–°—Ç—É–¥–∏—è{% else %}{{ property.rooms }}-–∫–æ–º–Ω.{% endif %}
                </span>
                {% endif %}
                
                {% if property.area %}
                <span style="background: #f0fdf4; color: #15803d; padding: 4px 10px; border-radius: 6px; font-size: 13px;">
                    {{ property.area|round(1) }} –º¬≤
                </span>
                {% endif %}
                
                {% if property.floor and property.total_floors %}
                <span style="background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 6px; font-size: 13px;">
                    {{ property.floor }}/{{ property.total_floors }} —ç—Ç
                </span>
                {% endif %}
            </div>
            
            {% if property.price %}
            <div style="margin: 8px 0;">
                <div style="font-size: 24px; font-weight: 700; color: #0088CC;">
                    {{ '{:,.0f}'.format(property.price).replace(',', ' ') }} ‚ÇΩ
                </div>
                {% if property.price_per_sqm %}
                <div style="font-size: 12px; color: #6b7280;">
                    {{ '{:,.0f}'.format(property.price_per_sqm).replace(',', ' ') }} ‚ÇΩ/–º¬≤
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            {% if property.residential_complex %}
            <p style="margin: 8px 0; color: #6b7280; font-size: 14px;">
                –ñ–ö {{ property.residential_complex.name }}
            </p>
            {% endif %}
            
            <a href="{{ base_url }}/property/{{ property.id }}" 
               style="display: inline-block; margin-top: 12px; background: #0088CC; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 600;">
                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
            </a>
        </div>
    </div>
</div>
{% endfor %}

<!-- View All Button -->
<div style="text-align: center; margin: 32px 0;">
    <a href="{{ base_url }}/properties" class="btn-primary">
        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
    </a>
</div>

<!-- Search Info -->
<div class="highlight-box">
    <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #1d1d1f;">
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ "{{ search.name }}"
    </h3>
    <p style="margin: 0; font-size: 14px; color: #6b7280;">
        {% if search.property_type %}–¢–∏–ø: {{ search.property_type }}{% endif %}
        {% if search.price_min or search.price_max %}
        <br>–¶–µ–Ω–∞: {% if search.price_min %}–æ—Ç {{ '{:,.0f}'.format(search.price_min).replace(',', ' ') }} ‚ÇΩ{% endif %}
        {% if search.price_max %}–¥–æ {{ '{:,.0f}'.format(search.price_max).replace(',', ' ') }} ‚ÇΩ{% endif %}
        {% endif %}
        {% if search.size_min or search.size_max %}
        <br>–ü–ª–æ—â–∞–¥—å: {% if search.size_min %}–æ—Ç {{ search.size_min }} –º¬≤{% endif %}
        {% if search.size_max %}–¥–æ {{ search.size_max }} –º¬≤{% endif %}
        {% endif %}
        {% if search.location %}<br>–†–∞–π–æ–Ω: {{ search.location }}{% endif %}
        {% if search.developer %}<br>–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫: {{ search.developer }}{% endif %}
    </p>
</div>

<!-- Tips -->
<div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #fbbf24; border-radius: 8px; padding: 20px; margin: 24px 0;">
    <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #78350f;">
        üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
    </h4>
    <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 14px; color: #92400e; line-height: 1.6;">
        <li>–û–±—ä–µ–∫—Ç—ã —Ä–∞–∑–±–∏—Ä–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ - –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä</li>
        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç</li>
        <li>–î–æ–±–∞–≤—å—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</li>
        <li>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</li>
    </ul>
</div>

<!-- Unsubscribe -->
<div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb; text-align: center;">
    <p style="font-size: 13px; color: #9ca3af; margin: 0;">
        –ù–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ "{{ search.name }}".<br>
        <a href="{{ unsubscribe_url }}" style="color: #6b7280; text-decoration: underline;">
            –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        </a> | 
        <a href="{{ base_url }}/user/dashboard?tab=saved-searches" style="color: #6b7280; text-decoration: underline;">
            –£–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        </a>
    </p>
</div>
{% endblock %}
