{% extends "base.html" %}

{% block title %}{{ property.title }} - {{ property.complex_name }} с кэшбеком {{ property.cashback_percent }}%{% endblock %}

{% block extra_head %}
<!-- Yandex Maps styling -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
<style>
.custom-property-marker {
    background: transparent !important;
    border: none !important;
}

.property-gallery-dot.active {
    background-color: white !important;
}

.gallery-slides {
    transition: transform 0.5s ease-in-out;
}
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<div class="container mx-auto px-4 py-3 text-sm">
    <nav aria-label="Breadcrumb" class="flex">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a class="text-[#0088CC] hover:underline inline-flex items-center" href="/">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                    </svg>
                    Главная
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <a href="{{ url_for('properties') }}" class="text-[#0088CC] hover:underline ml-1 md:ml-2">Квартиры</a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <a href="{{ url_for('residential_complex_detail', complex_id=property.complex_id) }}" class="text-[#0088CC] hover:underline ml-1 md:ml-2">{{ property.complex_name }}</a>
                </div>
            </li>
            <li aria-current="page">
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-gray-500 ml-1 md:ml-2">{{ property.title }}</span>
                </div>
            </li>
        </ol>
    </nav>
</div>

<div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Кэшбек баннер -->
    <div class="bg-gradient-to-r from-[#006699] to-[#0088CC] rounded-2xl p-6 text-white mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div class="mb-4 md:mb-0">
                <h2 class="text-2xl font-bold mb-2">Получите кэшбек {{ property.cashback_percent }}% при покупке этой квартиры!</h2>
                <p class="opacity-90">Приобретая эту квартиру через наш сервис, вы получите кэшбек 
                    {% if property.cashback_amount %}
                        {{ "{:,.0f}".format(property.cashback_amount).replace(',', ' ') }} ₽
                    {% else %}
                        до 5% от стоимости
                    {% endif %} 
                    на карту после сделки.</p>
            </div>
            <button onclick="openApplicationModal()" class="bg-white text-[#0088CC] hover:bg-opacity-90 font-semibold px-6 py-3 rounded-xl whitespace-nowrap transition-all">
                Получить кэшбек
            </button>
        </div>
    </div>

    <!-- Основная карточка -->
    <div class="bg-white rounded-2xl overflow-hidden shadow-lg mb-8">
        <!-- Галерея -->
        <div class="relative">
            <!-- Action Buttons -->
            <div class="absolute top-4 right-4 z-20 flex gap-2">
                <!-- Favorite -->
                <div class="favorite-heart w-10 h-10 bg-white/95 backdrop-blur-sm rounded-full flex items-center justify-center cursor-pointer hover:bg-white transition-all duration-200 shadow-lg hover:shadow-xl" data-property-id="{{ property.id }}" title="Добавить в избранное" onclick="if(window.favoritesManager) { window.favoritesManager.toggleFavorite('{{ property.id }}', this); event.stopPropagation(); }">
                    <i class="fas fa-heart text-lg text-gray-400 hover:text-red-500 transition-colors duration-200"></i>
                </div>
                
                <!-- Compare -->
                <div class="w-10 h-10 bg-white/95 backdrop-blur-sm rounded-full flex items-center justify-center cursor-pointer hover:bg-white hover:scale-110 transition-all duration-200 shadow-lg hover:shadow-xl border border-gray-300 hover:border-blue-300" data-property-id="{{ property.id }}" title="Добавить к сравнению" onclick="addToCompare({{ property.id }}); event.stopPropagation();">
                    <i class="fas fa-balance-scale text-gray-600 hover:text-blue-500 transition-colors duration-200"></i>
                </div>
                
                <!-- Share -->
                <div class="w-10 h-10 bg-white/95 backdrop-blur-sm rounded-full flex items-center justify-center cursor-pointer hover:bg-white hover:scale-110 transition-all duration-200 shadow-lg hover:shadow-xl border border-gray-300 hover:border-green-300" title="Поделиться" onclick="shareProperty(); event.stopPropagation();">
                    <i class="fas fa-share-alt text-gray-600 hover:text-green-500 transition-colors duration-200"></i>
                </div>
            </div>
            
            <div class="h-64 md:h-80 bg-gray-200 overflow-hidden gallery-container">
                <div class="gallery-slides flex h-full transition-transform duration-500">
                    {% if property.gallery and property.gallery|length > 0 %}
                        {% for image in property.gallery %}
                        <div class="gallery-slide min-w-full h-full">
                            <img alt="{{ property.title }}" class="w-full h-full object-cover" src="{{ image }}"/>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="gallery-slide min-w-full h-full bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center">
                            <div class="text-center text-gray-500">
                                <i class="fas fa-home text-6xl mb-4 text-[#0088CC]"></i>
                                <h3 class="text-xl font-semibold">{{ property.title }}</h3>
                                <p class="text-gray-400">{{ property.area }} м² • {{ property.complex_name }}</p>
                            </div>
                        </div>
                        <div class="gallery-slide min-w-full h-full">
                            <img alt="{{ property.title }} - планировка" class="w-full h-full object-cover" src="{{ property.layout_image }}" onerror="this.style.display='none'"/>
                        </div>
                        <div class="gallery-slide min-w-full h-full">
                            <img alt="{{ property.title }} - вид 3" class="w-full h-full object-cover" src="{{ property.image.replace('10bda24f-992f-48f3-a226-2c6a69a13a77', '16e887cc-303e-4925-9533-d08baa95aad7') }}" onerror="this.src='{{ property.image }}'"/>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Navigation buttons -->
                <button onclick="prevPropertySlide()" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-600 hover:bg-white transition-all z-10">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button onclick="nextPropertySlide()" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-600 hover:bg-white transition-all z-10">
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <!-- Dots indicator -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10">
                    <div class="property-gallery-dot w-2 h-2 bg-white/60 rounded-full cursor-pointer hover:bg-white transition-colors active" onclick="goToPropertySlide(0)"></div>
                    <div class="property-gallery-dot w-2 h-2 bg-white/60 rounded-full cursor-pointer hover:bg-white transition-colors" onclick="goToPropertySlide(1)"></div>
                    <div class="property-gallery-dot w-2 h-2 bg-white/60 rounded-full cursor-pointer hover:bg-white transition-colors" onclick="goToPropertySlide(2)"></div>
                </div>
            </div>
        </div>

        <!-- Основной контент -->
        <div class="p-6">
            <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-6">
                <!-- Левая колонка -->
                <div class="flex-1">
                    <!-- Заголовок и метки -->
                    <div class="mb-4">
                        <h1 class="text-2xl md:text-3xl font-bold mb-2">{{ property.title }}</h1>
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="bg-gray-100 text-[#0088CC] px-3 py-1 rounded-full text-sm">{{ property.status|default('В продаже', true) }}</span>
                            <span class="bg-gray-100 text-purple-700 px-3 py-1 rounded-full text-sm">{{ property.finishing|default('Чистовая отделка', true) }}</span>
                            <span class="bg-gray-100 text-green-700 px-3 py-1 rounded-full text-sm">{{ property.floor }}/{{ property.total_floors }} этаж</span>
                            {% if property.balcony %}
                            <span class="bg-gray-100 text-yellow-700 px-3 py-1 rounded-full text-sm">Балкон {{ property.balcony_area }} м²</span>
                            {% endif %}
                            <span class="bg-gray-100 text-blue-700 px-3 py-1 rounded-full text-sm">{{ property.building|default('Корпус', true) }}</span>
                        </div>
                    </div>

                    <!-- Адрес -->
                    <div class="mb-6">
                        <div class="flex items-center text-gray-600 mb-1">
                            <i class="fas fa-map-marker-alt mr-2 text-[#0088CC]"></i>
                            <span>{{ property.address }}</span>
                        </div>
                        {% if property.short_address and property.short_address != property.address %}
                        <p class="text-sm text-gray-500">{{ property.short_address }}</p>
                        {% endif %}
                        {% if property.locality_name %}
                        <p class="text-sm text-gray-500">{{ property.locality_name }}</p>
                        {% endif %}
                        {% if property.nearby %}
                        <p class="text-sm text-gray-500">Рядом: {{ property.nearby }}</p>
                        {% endif %}
                    </div>

                    <!-- Характеристики -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <p class="text-gray-500 text-sm">Площадь</p>
                            <p class="font-semibold">{{ property.area }} м²</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">Этаж</p>
                            <p class="font-semibold">{{ property.floor }} из {{ property.total_floors }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">Класс жилья</p>
                            <p class="font-semibold">{{ property.class_type }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">Тип отделки</p>
                            <p class="font-semibold">{{ property.renovation_display_name or 'Без отделки' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">Застройщик</p>
                            <p class="font-semibold">{{ property.developer }}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">Срок сдачи</p>
                            <p class="font-semibold">{{ property.completion_date }}</p>
                        </div>
                        {% if property.building_name %}
                        <div>
                            <p class="text-gray-500 text-sm">Корпус</p>
                            <p class="font-semibold">{{ property.building_name }}</p>
                        </div>
                        {% endif %}
                        {% if property.placement_type %}
                        <div>
                            <p class="text-gray-500 text-sm">Тип недвижимости</p>
                            <p class="font-semibold">{{ property.placement_type }}</p>
                        </div>
                        {% endif %}
                        {% if property.deal_type %}
                        <div>
                            <p class="text-gray-500 text-sm">Тип сделки</p>
                            <p class="font-semibold">{{ property.deal_type }}</p>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Описание -->
                    {% if property.description %}
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3">Об этой квартире</h3>
                        <p class="text-gray-700 mb-3">{{ property.description }}</p>
                        {% if property.detailed_description %}
                        <p class="text-gray-700">{{ property.detailed_description }}</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Особенности и услуги -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3">Особенности и услуги</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {% if property.has_accreditation %}
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check text-xs text-green-600"></i>
                                </div>
                                <span class="text-sm">Аккредитация банков</span>
                            </div>
                            {% endif %}
                            
                            {% if property.has_green_mortgage %}
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-leaf text-xs text-green-600"></i>
                                </div>
                                <span class="text-sm">Зеленая ипотека</span>
                            </div>
                            {% endif %}
                            
                            {% if property.has_mortgage_subsidy %}
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-percent text-xs text-blue-600"></i>
                                </div>
                                <span class="text-sm">Субсидированная ипотека</span>
                            </div>
                            {% endif %}
                            
                            {% if property.trade_in_available %}
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-orange-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-exchange-alt text-xs text-orange-600"></i>
                                </div>
                                <span class="text-sm">Trade-in (обмен старого жилья)</span>
                            </div>
                            {% endif %}
                            
                            {% if property.with_renovation %}
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-paint-roller text-xs text-purple-600"></i>
                                </div>
                                <span class="text-sm">С ремонтом</span>
                            </div>
                            {% endif %}
                            
                            {% if property.features %}
                                {% for feature in property.features %}
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 bg-[#0088CC]/10 rounded-full flex items-center justify-center">
                                        <i class="fas fa-check text-xs text-[#0088CC]"></i>
                                    </div>
                                    <span class="text-sm">{{ feature }}</span>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Контакты и информация для покупки -->
                    {% if property.sales_phone or property.sales_address %}
                    <div class="mb-6 bg-gray-50 rounded-xl p-4">
                        <h3 class="font-bold text-lg mb-3">Контакты для покупки</h3>
                        {% if property.sales_phone and property.sales_phone != 'Уточняется' %}
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-phone text-[#0088CC]"></i>
                            <span class="font-medium">{{ property.sales_phone }}</span>
                        </div>
                        {% endif %}
                        {% if property.sales_address and property.sales_address != 'Уточняется' %}
                        <div class="flex items-center gap-2">
                            <i class="fas fa-map-marker-alt text-[#0088CC]"></i>
                            <span>{{ property.sales_address }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Правая колонка (цена и кэшбек) -->
                <div class="md:w-80 flex-shrink-0">
                    <!-- Цена -->
                    <div class="bg-gray-50 rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold">Стоимость квартиры</h3>
                        </div>
                        <div class="text-2xl font-bold mb-4 bg-gradient-to-r from-[#006699] to-[#0088CC] bg-clip-text text-transparent">
                            {% if property.price %}
                                {{ "{:,.0f}".format(property.price).replace(',', ' ') }} ₽
                            {% else %}
                                Цена по запросу
                            {% endif %}
                        </div>
                        <div class="text-sm text-gray-500 mb-4">
                            <div class="flex justify-between mb-1">
                                <span>Цена за м²</span>
                                <span class="font-medium">
                                    {% if property.square_price %}
                                        {{ "{:,.0f}".format(property.square_price).replace(',', ' ') }} ₽
                                    {% elif property.price and property.area %}
                                        {{ "{:,.0f}".format((property.price / property.area)).replace(',', ' ') }} ₽
                                    {% else %}
                                        По запросу
                                    {% endif %}
                                </span>
                            </div>
                            {% if property.mortgage_payment %}
                            <div class="flex justify-between mb-1">
                                <span>Ипотечный платеж</span>
                                <span class="font-medium">{{ "{:,.0f}".format(property.mortgage_payment).replace(',', ' ') }} ₽/мес</span>
                            </div>
                            {% endif %}
                            {% if property.mortgage_rate %}
                            <div class="flex justify-between mb-1">
                                <span>Ставка по ипотеке</span>
                                <span class="font-medium">от {{ property.mortgage_rate }}</span>
                            </div>
                            {% endif %}
                        </div>
                        <button onclick="openApplicationModal()" class="w-full bg-gradient-to-r from-[#006699] to-[#0088CC] hover:bg-opacity-90 text-white font-semibold py-3 px-4 rounded-xl transition-all mb-3">
                            Забронировать квартиру
                        </button>
                        
                        <!-- PDF и поделиться -->
                        <div class="flex gap-2 mb-3">
                            <a href="{{ url_for('property_pdf', property_id=property.id) }}" target="_blank" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-3 rounded-lg text-center text-sm transition-all">
                                <i class="fas fa-file-pdf mr-1"></i>
                                PDF
                            </a>
                            <button onclick="shareProperty()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-3 rounded-lg text-sm transition-all">
                                <i class="fas fa-share-alt mr-1"></i>
                                Поделиться
                            </button>
                        </div>
                    </div>
                    
                    <!-- Кэшбек -->
                    <div class="bg-blue-50 rounded-xl p-6 mb-6 border border-blue-100">
                        <h3 class="font-bold text-lg mb-3 text-[#0088CC]">Ваш кэшбек</h3>
                        <div class="flex items-end gap-2 mb-2">
                            <span class="text-2xl font-bold text-[#0088CC]">
                                {% if property.cashback_amount %}
                                    {{ "{:,.0f}".format(property.cashback_amount).replace(',', ' ') }} ₽
                                {% else %}
                                    0 ₽
                                {% endif %}
                            </span>
                        </div>
                        <div class="text-sm text-gray-500 mb-4">
                            {{ property.cashback_percent }}% от стоимости квартиры
                        </div>
                        <p class="text-sm text-gray-600 mb-4">
                            При покупке этой квартиры через наш сервис вы получаете дополнительный кэшбек на карту после сделки.
                        </p>
                        <button onclick="openApplicationModal()" class="w-full bg-white hover:bg-gray-50 text-[#0088CC] font-semibold py-3 px-4 rounded-xl border border-[#0088CC] transition-all">
                            Получить кэшбек
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Планировка -->
    {% if property.layout_image %}
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">Планировка квартиры</h2>
        <div class="flex justify-center">
            <img alt="Планировка {{ property.title }}" class="max-w-full h-auto rounded-xl" src="{{ property.layout_image }}"/>
        </div>
    </div>
    {% endif %}

    <!-- Варианты отделки -->
    {% if property.finishing_options %}
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">Варианты отделки</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {% for option in property.finishing_options %}
            <div class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all">
                <div class="p-4">
                    <div class="font-semibold mb-2">{{ option.type }}</div>
                    <p class="text-sm text-gray-600 mb-3">{{ option.description }}</p>
                    {% if option.price_difference %}
                    <div class="text-sm font-medium text-[#0088CC]">{{ option.price_difference }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Информация о здании -->
    {% if property.building_info %}
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">О доме</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {% if property.building_info.type %}
            <div>
                <p class="text-gray-500 text-sm">Тип дома</p>
                <p class="font-semibold">{{ property.building_info.type }}</p>
            </div>
            {% endif %}
            {% if property.building_info.class %}
            <div>
                <p class="text-gray-500 text-sm">Класс</p>
                <p class="font-semibold">{{ property.building_info.class }}</p>
            </div>
            {% endif %}
            {% if property.building_info.year %}
            <div>
                <p class="text-gray-500 text-sm">Год постройки</p>
                <p class="font-semibold">{{ property.building_info.year }}</p>
            </div>
            {% endif %}
            {% if property.building_info.parking %}
            <div>
                <p class="text-gray-500 text-sm">Паркинг</p>
                <p class="font-semibold">{{ property.building_info.parking }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Инфраструктура -->
    {% if property.infrastructure %}
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">Инфраструктура</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            {% for item in property.infrastructure %}
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-[#0088CC]/10 rounded-full flex items-center justify-center">
                    <i class="fas fa-{{ item.icon|default('check', true) }} text-[#0088CC]"></i>
                </div>
                <div>
                    <div class="font-medium">{{ item.name }}</div>
                    {% if item.distance %}
                    <div class="text-sm text-gray-500">{{ item.distance }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- О жилом комплексе -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">О жилом комплексе "{{ property.complex_name }}"</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="flex items-start gap-4">
                <div class="w-16 h-16 bg-[#0088CC]/10 rounded-xl flex items-center justify-center">
                    <i class="fas fa-building text-[#0088CC] text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Современная архитектура</h4>
                    <p class="text-sm text-gray-600">Авторский проект с панорамным остеклением и индивидуальным дизайном фасадов</p>
                </div>
            </div>
            <div class="flex items-start gap-4">
                <div class="w-16 h-16 bg-[#0088CC]/10 rounded-xl flex items-center justify-center">
                    <i class="fas fa-car text-[#0088CC] text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Подземный паркинг</h4>
                    <p class="text-sm text-gray-600">Охраняемый подземный паркинг с лифтами до квартир</p>
                </div>
            </div>
            <div class="flex items-start gap-4">
                <div class="w-16 h-16 bg-[#0088CC]/10 rounded-xl flex items-center justify-center">
                    <i class="fas fa-tree text-[#0088CC] text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Закрытый двор</h4>
                    <p class="text-sm text-gray-600">Благоустроенная территория без машин с детскими площадками</p>
                </div>
            </div>
            <div class="flex items-start gap-4">
                <div class="w-16 h-16 bg-[#0088CC]/10 rounded-xl flex items-center justify-center">
                    <i class="fas fa-shield-alt text-[#0088CC] text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Безопасность</h4>
                    <p class="text-sm text-gray-600">Круглосуточная охрана, видеонаблюдение и система контроля доступа</p>
                </div>
            </div>
        </div>
        
        <div class="mb-6">
            <h4 class="font-semibold mb-3">Квартиры в этом ЖК</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-2xl font-bold text-[#0088CC]">{{ property.complex_total_apartments or 'н/д' }}</div>
                    <div class="text-sm text-gray-600">всего квартир</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-2xl font-bold text-[#0088CC]">{{ property.same_type_apartments or 'н/д' }}</div>
                    <div class="text-sm text-gray-600">такой планировки</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-2xl font-bold text-[#0088CC]">{{ property.complex_buildings_count or 'н/д' }}</div>
                    <div class="text-sm text-gray-600">корпуса</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-2xl font-bold text-[#0088CC]">{{ property.completion_date }}</div>
                    <div class="text-sm text-gray-600">срок сдачи</div>
                </div>
            </div>
        </div>
        
        <div class="mt-6">
            <a href="{{ url_for('residential_complex_detail', complex_id=property.complex_id) }}" class="bg-[#0088CC] text-white px-6 py-3 rounded-lg hover:bg-[#0077BB] transition-colors inline-flex items-center gap-2">
                <i class="fas fa-building"></i>
                Подробнее о ЖК
            </a>
        </div>
    </div>

    <!-- Расположение на карте -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">Расположение квартиры</h2>
        <div class="mb-4">
            <div class="flex items-center text-gray-600 mb-2">
                <i class="fas fa-map-marker-alt mr-2 text-[#0088CC]"></i>
                <span class="font-medium">{{ property.complex_name }}</span>
            </div>
            <p class="text-sm text-gray-500">{{ property.address or property.short_address or property.locality_name or "Адрес уточняется" }}</p>
        </div>
        
        <!-- Карта -->
        <div id="property-map" class="w-full h-80 rounded-xl overflow-hidden mb-4"></div>
        
        <!-- Транспорт и инфраструктура рядом -->
        {% if property.transport %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-gray-100">
            <div>
                <h4 class="font-semibold mb-3 flex items-center gap-2">
                    <i class="fas fa-bus text-[#0088CC]"></i>
                    Транспорт
                </h4>
                <div class="space-y-2 text-sm">
                    {% if property.transport.bus_stops %}
                    <div class="text-gray-600">{{ property.transport.bus_stops }}</div>
                    {% endif %}
                    {% if property.transport.metro %}
                    <div class="text-gray-600">{{ property.transport.metro }}</div>
                    {% endif %}
                    {% if property.transport.highways %}
                    <div class="text-gray-600">{{ property.transport.highways }}</div>
                    {% endif %}
                </div>
            </div>
            <div>
                <h4 class="font-semibold mb-3 flex items-center gap-2">
                    <i class="fas fa-store text-[#0088CC]"></i>
                    Рядом
                </h4>
                <div class="space-y-2 text-sm">
                    {% if property.nearby %}
                    <div class="text-gray-600">{{ property.nearby }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Застройщик -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold mb-6">Застройщик</h2>
        <div class="flex items-start gap-6">
            <div class="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center">
                <span class="text-lg font-bold text-[#0088CC]">{{ property.developer[:3].upper() }}</span>
            </div>
            <div class="flex-1">
                <h3 class="text-xl font-semibold mb-2">{{ property.developer }}</h3>
                <p class="text-gray-600 mb-4">Надежный застройщик с многолетним опытом строительства качественного жилья в Краснодаре. Все объекты сданы в срок.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <span class="text-gray-500">Построено объектов:</span>
                        <div class="font-medium">15+</div>
                    </div>
                    <div>
                        <span class="text-gray-500">Опыт работы:</span>
                        <div class="font-medium">12 лет</div>
                    </div>
                    <div>
                        <span class="text-gray-500">Срок сдачи:</span>
                        <div class="font-medium">{{ property.completion_date|default('2025 год', true) }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<!-- Yandex Maps JS -->
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>

<script>
    // Initialize Swiper if exists
    if (document.querySelector('.swiper')) {
        const swiper = new Swiper('.swiper', {
            loop: {% if property.gallery and property.gallery|length > 1 %}true{% else %}false{% endif %},
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    }

    // Yandex Map initialization for property location
    var propertyLat = {{ property.address_position_lat or 45.0355 }};
    var propertyLng = {{ property.address_position_lon or 38.9753 }};
    
    ymaps.ready(function () {
        var propertyMap = new ymaps.Map('property-map', {
            center: [propertyLat, propertyLng],
            zoom: 15,
            controls: ['zoomControl', 'fullscreenControl']
        });
        
        var propertyPlacemark = new ymaps.Placemark([propertyLat, propertyLng], {
            balloonContent: '<div style="text-align: center; padding: 10px;">' +
                '<div style="font-weight: bold; color: #0088CC; margin-bottom: 5px;">{{ property.complex_name or "ЖК" }}</div>' +
                '<div style="color: #666; margin-bottom: 8px;">{{ property.address or property.short_address or property.locality_name or "Краснодар" }}</div>' +
                '<div style="font-size: 16px; font-weight: bold; color: #0088CC;">{{ "{:,.0f}".format(property.price if property.price else 0).replace(",", " ") }} ₽</div>' +
                '</div>'
        }, {
            preset: 'islands#redDotIcon'
        });
        
        propertyMap.geoObjects.add(propertyPlacemark);
        propertyPlacemark.balloon.open();
    });

    // Share property function
    function shareProperty() {
        const url = window.location.href;
        const title = document.title;
        
        if (navigator.share) {
            navigator.share({
                title: title,
                url: url
            }).catch(error => console.warn('Share error:', error));
        } else if (navigator.clipboard) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Ссылка скопирована в буфер обмена!');
            }).catch(() => {
                fallbackCopyTextToClipboard(url);
            });
        } else {
            fallbackCopyTextToClipboard(url);
        }
    }

    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            alert('Ссылка скопирована в буфер обмена!');
        } catch (err) {
            alert('Не удалось скопировать ссылку. URL: ' + text);
        }
        
        document.body.removeChild(textArea);
    }
    
    // Property gallery functionality
    let currentPropertySlide = 0;
    const totalPropertySlides = 3;

    function nextPropertySlide() {
        currentPropertySlide = (currentPropertySlide + 1) % totalPropertySlides;
        updatePropertySlide();
    }

    function prevPropertySlide() {
        currentPropertySlide = (currentPropertySlide - 1 + totalPropertySlides) % totalPropertySlides;
        updatePropertySlide();
    }

    function goToPropertySlide(index) {
        currentPropertySlide = index;
        updatePropertySlide();
    }

    function updatePropertySlide() {
        const slides = document.querySelector('.gallery-slides');
        const dots = document.querySelectorAll('.property-gallery-dot');
        
        if (slides) {
            slides.style.transform = `translateX(-${currentPropertySlide * 100}%)`;
        }
        
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentPropertySlide);
        });
    }
</script>
{% endblock %}