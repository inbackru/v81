{% extends "base.html" %}

{% block title %}–£–ª–∏—Ü—ã –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞ —Å –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞–º–∏ | InBack{% endblock %}
{% block description %}–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É–ª–∏—Ü –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞ —Å –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –∫—ç—à–±–µ–∫–æ–º –¥–æ 500 000 ‚ÇΩ. –í—ã–±–µ—Ä–∏—Ç–µ —É–ª–∏—Ü—É –∏ –Ω–∞–π–¥–∏—Ç–µ –∫–≤–∞—Ä—Ç–∏—Ä—É —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –≤–æ–∑–≤—Ä–∞—Ç–æ–º –¥–µ–Ω–µ–≥.{% endblock %}
{% block keywords %}—É–ª–∏—Ü—ã –∫—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞, –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∞—Å–Ω–æ–¥–∞—Ä, –∫—ç—à–±–µ–∫ —É–ª–∏—Ü—ã{% endblock %}

{% block breadcrumbs %}
    <div class="container mx-auto px-4 py-3 text-sm">
        <nav class="flex" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{{ url_for('index') }}" class="text-[#0088CC] hover:underline inline-flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                        –ì–ª–∞–≤–Ω–∞—è
                    </a>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                        <span class="text-gray-500 ml-1 md:ml-2">–£–ª–∏—Ü—ã –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞</span>
                    </div>
                </li>
            </ol>
        </nav>
    </div>
{% endblock %}

{% block content %}
    <main class="container mx-auto px-4 py-8">
        <!-- SEO Text -->
        <section class="mb-12 bg-white rounded-lg shadow-sm p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞ —Å –∫—ç—à–±–µ–∫–æ–º –Ω–∞ –≤—Å–µ—Ö —É–ª–∏—Ü–∞—Ö –≥–æ—Ä–æ–¥–∞</h1>
            <div class="prose max-w-none text-gray-700">
                <p class="text-lg mb-4">–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä - –±—ã—Å—Ç—Ä–æ—Ä–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è –≥–æ—Ä–æ–¥ —Å –∞–∫—Ç–∏–≤–Ω—ã–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º –Ω–æ–≤—ã—Ö –∂–∏–ª—ã—Ö –∫–æ–º–ø–ª–µ–∫—Å–æ–≤. –°–µ—Ä–≤–∏—Å InBack –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å <strong>–∫—ç—à–±–µ–∫ –¥–æ 500 000 —Ä—É–±–ª–µ–π</strong> –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–µ –Ω–∞ –ª—é–±–æ–π —É–ª–∏—Ü–µ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞.</p>
                <p class="mb-4">–í –Ω–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã <strong>–≤—Å–µ —É–ª–∏—Ü—ã –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞</strong>, –≥–¥–µ –≤–µ–¥–µ—Ç—Å—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –∂–∏–ª—ã—Ö –∫–æ–º–ø–ª–µ–∫—Å–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –≤–∞—Å —É–ª–∏—Ü—É –∏ —É–∑–Ω–∞—Ç—å –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞—Ö, –∞ —Ç–∞–∫–∂–µ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–ª—É—á–µ–Ω–∏—è –∫—ç—à–±–µ–∫–∞.</p>
                
                <h3 class="text-xl font-semibold mt-6 mb-3">–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –ø–æ–∫—É–ø–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫—É —á–µ—Ä–µ–∑ InBack?</h3>
                <ul class="list-disc pl-6 space-y-2 mt-2">
                    <li>–í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–æ 500 000 —Ä—É–±–ª–µ–π –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã</li>
                    <li>–†–∞–±–æ—Ç–∞–µ–º —Å–æ –≤—Å–µ–º–∏ –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞–º–∏ –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–µ</li>
                    <li>–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –≤—Å–µ—Ö —É–ª–∏—Ü–∞—Ö –≥–æ—Ä–æ–¥–∞</li>
                    <li>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫—ç—à–±–µ–∫–∞</li>
                    <li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –∏ —Å–∫–∏–¥–∫–∏ –æ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</li>
                </ul>
            </div>
        </section>

        <!-- Search and Alphabet Navigation -->
        <div class="bg-white rounded-lg shadow-sm mb-6 sticky top-0 z-10">
            <!-- Search Bar -->
            <div class="px-4 py-3 border-b border-gray-200">
                <div class="relative">
                    <input type="text" 
                           id="streetSearch" 
                           data-street-search="true"
                           placeholder="–ü–æ–∏—Å–∫ —É–ª–∏—Ü—ã..." 
                           class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0088CC] focus:border-transparent">
                    <svg class="w-5 h-5 absolute left-3 top-2.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
            </div>
            
            <!-- Alphabet Navigation -->
            <div class="px-2 py-2 border-b border-gray-200 flex flex-wrap gap-1">
                <a href="#all" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm bg-[#0088CC] text-white rounded" data-letter="all">–í—Å–µ</a>
                <a href="#1" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="1">1</a>
                <a href="#2" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="2">2</a>
                <a href="#3" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="3">3</a>
                <a href="#4" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="4">4</a>
                <a href="#5" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="5">5</a>
                <a href="#6" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="6">6</a>
                <a href="#7" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="7">7</a>
                <a href="#8" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="8">8</a>
                <a href="#9" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="9">9</a>
                <a href="#a" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ê">–ê</a>
                <a href="#b" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ë">–ë</a>
                <a href="#v" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–í">–í</a>
                <a href="#g" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ì">–ì</a>
                <a href="#d" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–î">–î</a>
                <a href="#e" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ï">–ï</a>
                <a href="#zh" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ñ">–ñ</a>
                <a href="#z" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ó">–ó</a>
                <a href="#i" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ò">–ò</a>
                <a href="#k" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ö">–ö</a>
                <a href="#l" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–õ">–õ</a>
                <a href="#m" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ú">–ú</a>
                <a href="#n" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ù">–ù</a>
                <a href="#o" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–û">–û</a>
                <a href="#p" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ü">–ü</a>
                <a href="#r" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–†">–†</a>
                <a href="#s" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–°">–°</a>
                <a href="#t" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–¢">–¢</a>
                <a href="#u" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–£">–£</a>
                <a href="#f" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–§">–§</a>
                <a href="#h" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–•">–•</a>
                <a href="#c" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–¶">–¶</a>
                <a href="#ch" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–ß">–ß</a>
                <a href="#sh" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–®">–®</a>
                <a href="#sch" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–©">–©</a>
                <a href="#e2" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–≠">–≠</a>
                <a href="#ya" class="alphabet-link whitespace-nowrap px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded" data-letter="–Ø">–Ø</a>
            </div>

            <!-- Results Counter -->
            <div class="px-4 py-2 text-sm text-gray-600 border-b border-gray-200">
                –ù–∞–π–¥–µ–Ω–æ <span id="results-count">{{ streets|length }}</span> —É–ª–∏—Ü
            </div>
        </div>

        <!-- Streets List -->
        <div class="bg-white rounded-lg shadow-sm">
            {% if streets %}
            <div id="streets-container" class="divide-y divide-gray-200">
                {% for street in streets %}
                <div class="street-item p-4 hover:bg-gray-50 transition-colors" data-street="{{ street.name|lower }}" data-letter="{{ street.letter or street.name[0]|upper }}">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ street.name }}</h3>
                                    <p class="text-sm text-gray-600 mb-2">{{ street.district }}</p>
                                    <div class="text-sm text-gray-500">
                                        –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ —Å –∫—ç—à–±–µ–∫–æ–º –¥–æ 500 000 ‚ÇΩ
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ml-4">
                            <a href="{{ url_for('street_detail', street_name=street.slug) }}" 
                               class="inline-flex items-center px-4 py-2 bg-[#0088CC] text-white text-sm font-medium rounded-lg hover:bg-[#006699] transition-colors">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Empty State (for search) -->
            <div id="empty-state" class="hidden text-center py-12">
                <div class="text-gray-400 text-6xl mb-4">üîç</div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">–£–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p class="text-gray-500">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
            </div>
            {% else %}
            <!-- Empty State (no data for this city) -->
            <div class="text-center py-16 px-4">
                <div class="text-gray-400 text-6xl mb-4">üèóÔ∏è</div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">–î–∞–Ω–Ω—ã–µ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</h3>
                <p class="text-gray-500 mb-6">
                    –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É–ª–∏—Ü –¥–ª—è {{ current_city.name_genitive if current_city else '—ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞' }} –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.<br>
                    –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É–ª–∏—Ü —Å –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞–º–∏.
                </p>
                <a href="{{ url_for('properties') }}" 
                   class="inline-flex items-center px-6 py-3 bg-[#0088CC] text-white font-medium rounded-lg hover:bg-[#006699] transition-colors">
                    –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
            {% endif %}
        </div>
    </main>
{% endblock %}

{% block extra_js %}
<script>
// Streets search functionality
(function() {
    // Streets data for JavaScript
    const streetsData = {{ streets|tojson|safe }};
    let filteredStreets = [...streetsData];
    
    console.log('[Streets] Loaded:', streetsData.length, 'items');
    
    // Search functionality - isolated from other search systems
    function setupStreetSearch() {
        const searchInput = document.querySelector('input[data-street-search="true"]');
        const alphabetLinks = document.querySelectorAll('.alphabet-link');
        
        console.log('[Streets] Setting up search:', {searchInput: !!searchInput, alphabetCount: alphabetLinks.length});
        
        if (!searchInput) {
            console.error('[Streets] Search input not found');
            return;
        }
        
        // Remove any existing listeners to prevent duplicates
        const newSearchInput = searchInput.cloneNode(true);
        searchInput.parentNode.replaceChild(newSearchInput, searchInput);
        
        // Search input handler with event isolation
        newSearchInput.addEventListener('input', function(e) {
            e.stopPropagation();
            const query = this.value.toLowerCase().trim();
            console.log('[Streets] Search query:', query);
            filterStreets(query);
        });
        
        // Prevent SuperSearch from capturing this input
        newSearchInput.addEventListener('focus', function(e) {
            e.stopPropagation();
            console.log('[Streets] Search focused');
        });
        
        newSearchInput.addEventListener('keydown', function(e) {
            e.stopPropagation();
        });
        
        // Alphabet navigation handler
        alphabetLinks.forEach((link, index) => {
            // Clone to remove existing listeners
            const newLink = link.cloneNode(true);
            link.parentNode.replaceChild(newLink, link);
            
            newLink.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                console.log('[Streets] Alphabet click:', this.dataset.letter);
                
                // Update active state
                document.querySelectorAll('.alphabet-link').forEach(l => {
                    l.classList.remove('bg-[#0088CC]', 'text-white');
                    l.classList.add('text-gray-700', 'hover:bg-gray-100');
                });
                this.classList.add('bg-[#0088CC]', 'text-white');
                this.classList.remove('text-gray-700', 'hover:bg-gray-100');
                
                const letter = this.dataset.letter;
                filterByLetter(letter);
            });
        });
    }

    // Filter streets by search query
    function filterStreets(query) {
        if (!query) {
            showAllStreets();
            return;
        }
        
        filteredStreets = streetsData.filter(street => {
            const nameMatch = street.name && street.name.toLowerCase().includes(query);
            const districtMatch = street.district && street.district.toLowerCase().includes(query);
            return nameMatch || districtMatch;
        });
        
        console.log('[Streets] Filtered results:', filteredStreets.length);
        updateStreetsDisplay();
    }

    // Filter streets by letter
    function filterByLetter(letter) {
        if (letter === 'all') {
            showAllStreets();
            return;
        }
        
        filteredStreets = streetsData.filter(street => {
            if (!street.name) return false;
            const streetLetter = street.letter || getFirstLetter(street.name);
            return streetLetter === letter;
        });
        
        console.log('[Streets] Filtered by letter results:', filteredStreets.length);
        updateStreetsDisplay();
    }
    
    // Get first letter of street name
    function getFirstLetter(name) {
        if (!name) return '';
        const firstChar = name.charAt(0).toUpperCase();
        return /\d/.test(firstChar) ? firstChar : firstChar;
    }

    // Show all streets
    function showAllStreets() {
        filteredStreets = [...streetsData];
        updateStreetsDisplay();
    }
    
    // Update streets display
    function updateStreetsDisplay() {
        const container = document.getElementById('streets-container');
        const resultsCount = document.getElementById('results-count');
        const emptyState = document.getElementById('empty-state');
        
        if (!container) {
            console.error('[Streets] Container not found');
            return;
        }
        
        // Update results count
        if (resultsCount) {
            resultsCount.textContent = filteredStreets.length;
        }
        
        // Get all street items
        const streetItems = container.querySelectorAll('.street-item');
        console.log('[Streets] Updating display:', filteredStreets.length, 'streets,', streetItems.length, 'DOM items');
        
        // Show/hide empty state
        if (filteredStreets.length === 0) {
            if (emptyState) emptyState.classList.remove('hidden');
            streetItems.forEach(item => item.style.display = 'none');
        } else {
            if (emptyState) emptyState.classList.add('hidden');
            
            // Show/hide street items based on filter
            streetItems.forEach(item => {
                const streetName = item.dataset.street;
                const isVisible = filteredStreets.some(street => 
                    street.name && street.name.toLowerCase() === streetName.toLowerCase()
                );
                item.style.display = isVisible ? 'block' : 'none';
            });
        }
    }
    
    // Initialize when page is ready
    function initializeStreetSearch() {
        console.log('[Streets] Initializing search functionality...');
        setupStreetSearch();
        updateStreetsDisplay();
    }
    
    // Wait for DOM and other scripts to load, but initialize after everything else
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeStreetSearch, 500); // Wait for other scripts
        });
    } else {
        // DOM already loaded
        setTimeout(initializeStreetSearch, 500);
    }
    
})();
</script>
{% endblock %}